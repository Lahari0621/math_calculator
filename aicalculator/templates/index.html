<!--
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>AI Calculator — Final</title>
<style>
  body { background:#121212; color:#e6fff8; font-family:Inter,Arial; margin:0; padding:20px; display:flex; justify-content:center; }
  .layout { display:flex; gap:20px; max-width:1200px; width:100%; }
  .calculator { width:480px; background:#1e1e1e; padding:18px; border-radius:12px; box-shadow:0 6px 30px rgba(0,255,204,0.06); }
  #display { width:100%; height:60px; padding:12px; font-size:18px; border-radius:8px; border:none; background:#111; color:#dfffe8; margin-bottom:12px; }
  .buttons { display:grid; grid-template-columns:repeat(5,1fr); gap:10px; }
  button { background:#00ffcc; border:none; padding:12px; border-radius:8px; font-weight:600; cursor:pointer; color:#002; }
  button:hover{ filter:brightness(.95); }
  .small { padding:8px; font-size:14px; }
  .panel { width:420px; background:#161616; padding:14px; border-radius:12px; }
  .history { max-height:620px; overflow:auto; }
  .hist-entry { background:#0f1720; padding:8px; margin-bottom:8px; border-radius:8px; font-size:13px; color:#cfffe6; }
  .matrix-controls { display:flex; gap:8px; margin-bottom:10px; flex-wrap:wrap; }
  input[type="number"], input[type="text"], select { padding:8px; border-radius:6px; border:1px solid #0ff; background:#0b0b0b; color:#cfffe6; }
  .matrix-grid input { width:60px; margin:4px; padding:6px; border-radius:6px; border:1px solid #0ff; background:#0b0b0b; color:#cfffe6; }
  .matrix-result { margin-top:8px; color:#dfffe8; }
  .op-select { padding:8px; border-radius:6px; border:1px solid #0ff; background:#0b0b0b; color:#cfffe6;}
</style>
</head>
<body>
  <div class="layout">
    <div class="calculator">
      <div style="margin-bottom:12px;">
        <strong>Matrix generator (start)</strong>
        <div class="matrix-controls" style="margin-top:8px;">
          <label>Count <input type="number" id="mat-count" value="2" min="1" /></label>
          <label>Rows <input type="number" id="mat-rows" value="2" min="1" /></label>
          <label>Cols <input type="number" id="mat-cols" value="2" min="1" /></label>
          <button onclick="generateMatrices()" class="small">Generate</button>
        </div>
      </div>

      
      <input id="display" type="text" placeholder="type expression or use buttons" />

   
      <div class="buttons">
        <button onclick="push('7')">7</button>
        <button onclick="push('8')">8</button>
        <button onclick="push('9')">9</button>
        <button onclick="push('/')">÷</button>
        <button onclick="backspace()">⌫</button>

        <button onclick="push('4')">4</button>
        <button onclick="push('5')">5</button>
        <button onclick="push('6')">6</button>
        <button onclick="push('*')">×</button>
        <button onclick="push('^')">^</button>

        <button onclick="push('1')">1</button>
        <button onclick="push('2')">2</button>
        <button onclick="push('3')">3</button>
        <button onclick="push('-')">−</button>
        <button onclick="push('(')">(</button>

        <button onclick="push('0')">0</button>
        <button onclick="push('.')">.</button>
        <button onclick="push('=')">=</button>
        <button onclick="push('+')">+</button>
        <button onclick="push(')')">)</button>

        <button onclick="push('sin(')">sin</button>
        <button onclick="push('cos(')">cos</button>
        <button onclick="push('tan(')">tan</button>
        <button onclick="push('sqrt(')">√</button>
        <button onclick="push('log(')">log</button>

        <button onclick="push('diff(')">diff</button>
        <button onclick="push('integrate(')">∫</button>
        <button onclick="push('x')">x</button>
        <button onclick="push('y')">y</button>
        <button onclick="push('pi')">π</button>

        <button onclick="push('e')">e</button>
        <button onclick="compute()" style="grid-column:span 2;">Compute</button>
        <button onclick="clearDisplay()" style="grid-column:span 2;">Clear</button>
      </div>

     
      <div id="mat-area" style="margin-top:12px;"></div>

      <div style="margin-top:10px;">
        Mode:
        <select id="mode">
          <option value="radian">Radian</option>
          <option value="degree">Degree</option>
        </select>
        Output:
        <select id="output">
          <option value="dec">Decimal</option>
          <option value="frac">Fraction</option>
        </select>
      </div>
    </div>

    
    <div class="panel">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
        <h3 style="margin:0">History</h3>
        <button onclick="clearHistory()" style="padding:6px 8px; border-radius:6px; border:1px solid #0ff; background:#0b0b0b; color:#cfffe6;">Clear History</button>
      </div>
      <div id="history" class="history"></div>

      <div style="margin-top:12px;">
        <strong>Matrix result (also sent to display)</strong>
        <div id="matrixResult" class="matrix-result"></div>
      </div>
    </div>
  </div>

<script>
/* ---------- Helpers ---------- */
const display = document.getElementById('display');
function push(txt){
  display.value += txt;
  display.focus();
}
function clearDisplay(){ display.value = ''; display.focus(); }
function backspace(){ display.value = display.value.slice(0,-1); display.focus(); }

/* ---------- Keyboard support ---------- */
document.addEventListener('keydown', (e)=>{
  // allow normal typing into display
  if (e.key === 'Enter') { compute(); e.preventDefault(); return; }
  if (e.key === 'Backspace') { backspace(); return; }
  // otherwise let user type in the display normally — nothing forced
});

/* ---------- Compute (expression) ---------- */
async function compute(){
  const expr = display.value.trim();
  if(!expr) return;
  const mode = document.getElementById('mode').value;
  const output = document.getElementById('output').value;

  try {
    const resp = await fetch('/evaluate', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ expression: expr, mode: mode, output: output })
    });
    const data = await resp.json();
    if(resp.ok){
      // update display and history
      display.value = data.result;
      renderHistory(data.history);
    } else {
      // error
      display.value = data.error || 'Error';
      renderHistory(data.history || []);
    }
  } catch(err){
    display.value = 'Error';
    console.error(err);
  }
}

/* ---------- History rendering ---------- */
function renderHistory(hist){
  const el = document.getElementById('history');
  el.innerHTML = '';
  // show newest on top
  for(let i = hist.length-1; i >=0; --i){
    const entry = hist[i];
    const div = document.createElement('div');
    div.className = 'hist-entry';

    // If entry contains HTML table (for matrices) we allow it
    if (entry.includes('<table')) {
      div.innerHTML = entry;
    } else {
      div.textContent = entry;
    }
    el.appendChild(div);
  }
}

/* ---------- Clear history ---------- */
async function clearHistory(){
  await fetch('/clear_history', { method:'POST' });
  document.getElementById('history').innerHTML = '';
}

/* ---------- Matrix generator (start) ---------- */
function generateMatrices(){
  const count = Math.max(1, parseInt(document.getElementById('mat-count').value || 1));
  const rows = Math.max(1, parseInt(document.getElementById('mat-rows').value || 1));
  const cols = Math.max(1, parseInt(document.getElementById('mat-cols').value || 1));
  const area = document.getElementById('mat-area');
  area.innerHTML = '';

  // operation select + compute button
  const controls = document.createElement('div');
  controls.className = 'matrix-controls';
  controls.innerHTML = `
    <select id="mat-op" class="op-select">
      <option value="add">Add</option>
      <option value="sub">Subtract</option>
      <option value="mul">Multiply</option>
      <option value="div">Divide (A * inv(B))</option>
      <option value="det">Determinant (first)</option>
      <option value="transpose">Transpose (first)</option>
      <option value="inverse">Inverse (first)</option>
    </select>
    <button onclick="computeMatrix()">Compute Matrix</button>
  `;
  area.appendChild(controls);

  // create inputs for each matrix
  for(let k=0;k<count;k++){
    const box = document.createElement('div');
    box.style.marginTop = '10px';
    box.innerHTML = `<strong>Matrix ${k+1}</strong><div class="matrix-grid" id="matgrid_${k}"></div>`;
    area.appendChild(box);

    const grid = box.querySelector(`#matgrid_${k}`);
    for(let r=0;r<rows;r++){
      const rowDiv = document.createElement('div');
      for(let c=0;c<cols;c++){
        const inp = document.createElement('input');
        inp.type='number';
        inp.id = `m_${k}_${r}_${c}`;
        inp.value = '0';
        inp.style.width = '64px';
        rowDiv.appendChild(inp);
      }
      grid.appendChild(rowDiv);
    }
  }
}

/* ---------- Matrix compute ---------- */
async function computeMatrix(){
  // collect matrices from inputs
  const count = Math.max(1, parseInt(document.getElementById('mat-count').value || 1));
  const rows = Math.max(1, parseInt(document.getElementById('mat-rows').value || 1));
  const cols = Math.max(1, parseInt(document.getElementById('mat-cols').value || 1));
  const mats = [];

  for(let k=0;k<count;k++){
    const arr = [];
    for(let r=0;r<rows;r++){
      const row = [];
      for(let c=0;c<cols;c++){
        const val = parseFloat(document.getElementById(`m_${k}_${r}_${c}`).value || 0);
        row.push(val);
      }
      arr.push(row);
    }
    mats.push(arr);
  }

  const op = document.getElementById('mat-op').value;

  try {
    const resp = await fetch('/matrix', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ matrices: mats, operation: op })
    });
    const data = await resp.json();

    if(resp.ok){
      // For matrix result we put compact string in display and pretty HTML in matrixResult & history
      const res = data.result;
      display.value = res;

      // find newest history entry sent back and render -> backend stores pretty HTML for matrices
      renderHistory(data.history);
      // Also show pretty table in matrix result box if last history contains a table
      const last = data.history && data.history.length ? data.history[data.history.length-1] : '';
      const matrixResultDiv = document.getElementById('matrixResult');
      if(last && last.includes('<table')){
        matrixResultDiv.innerHTML = last;
      } else {
        matrixResultDiv.innerText = res;
      }
    } else {
      display.value = data.error || 'Error';
      renderHistory(data.history || []);
    }
  } catch(err){
    display.value = 'Error';
    console.error(err);
  }
}

/* ---------- init: generate at least once ---------- */
generateMatrices();
</script>
</body>
</html>
-->

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>AI Calculator — Final</title>
<style>
  body { background:#121212; color:#e6fff8; font-family:Inter,Arial; margin:0; padding:20px; display:flex; justify-content:center; }
  .layout { display:flex; gap:20px; max-width:1200px; width:100%; }
  .calculator { width:480px; background:#1e1e1e; padding:18px; border-radius:12px; box-shadow:0 6px 30px rgba(0,255,204,0.06); }
  #display { width:100%; height:60px; padding:12px; font-size:18px; border-radius:8px; border:none; background:#111; color:#dfffe8; margin-bottom:12px; }
  .buttons { display:grid; grid-template-columns:repeat(5,1fr); gap:10px; }
  button { background:#00ffcc; border:none; padding:12px; border-radius:8px; font-weight:600; cursor:pointer; color:#002; }
  button:hover{ filter:brightness(.95); }
  .small { padding:8px; font-size:14px; }
  .panel { width:420px; background:#161616; padding:14px; border-radius:12px; }
  .history { max-height:620px; overflow:auto; }
  .hist-entry { background:#0f1720; padding:8px; margin-bottom:8px; border-radius:8px; font-size:13px; color:#cfffe6; }
  .matrix-controls { display:flex; gap:8px; margin-bottom:10px; flex-wrap:wrap; }
  input[type="number"], input[type="text"], select { padding:8px; border-radius:6px; border:1px solid #0ff; background:#0b0b0b; color:#cfffe6; }
  .matrix-grid input { width:60px; margin:4px; padding:6px; border-radius:6px; border:1px solid #0ff; background:#0b0b0b; color:#cfffe6; }
  .matrix-result { margin-top:8px; color:#dfffe8; }
  .op-select { padding:8px; border-radius:6px; border:1px solid #0ff; background:#0b0b0b; color:#cfffe6;}
</style>
</head>
<body>

<!-- Guidelines toggle button -->
<button id="guidelinesBtn" title="Show Guidelines" 
  style="
    position: fixed;
    top: 20px;
    right: 20px;
    background: #00ffcc;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    cursor: pointer;
    font-size: 24px;
    color: #002;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 8px #00ffccaa;
    z-index: 1000;
  ">
  &#x1F6C8; <!-- info symbol ℹ️ -->
</button>

<!-- Guidelines panel (hidden by default) -->
<div id="guidelinesPanel" 
  style="
    position: fixed;
    top: 70px;
    right: 20px;
    width: 320px;
    max-height: 400px;
    overflow-y: auto;
    background: #0f1f1a;
    border-radius: 12px;
    padding: 16px;
    font-size: 14px;
    color: #a0f0d0;
    box-shadow: 0 0 15px #00ffccaa;
    display: none;
    z-index: 1000;
  ">
  <strong>Usage Guidelines:</strong>
  <ul style="margin: 8px 0 0 20px; padding: 0; list-style-type: disc;">
    <li>Type algebraic, trigonometric, differentiation, or integration expressions in the input box.</li>
    <li>Use <code>^</code> for powers (e.g., <code>2^3</code> for 2 cubed).</li>
    <li>Supported functions: <code>sin()</code>, <code>cos()</code>, <code>tan()</code>, <code>cot()</code>, <code>sec()</code>, <code>csc()</code>, <code>sqrt()</code>, <code>log()</code>, <code>diff()</code>, <code>integrate()</code>.</li>
    <li>For differentiation, use <code>diff(expression)</code>, e.g., <code>diff(x^2)</code>.</li>
    <li>For integration, use <code>integrate(expression)</code>, e.g., <code>integrate(sin(x))</code>.</li>
    <li>To solve equations, type expressions with <code>=</code>, e.g., <code>2*x + 3 = 7</code>.</li>
    <li>Select angle mode (Radian or Degree) and output format (Decimal or Fraction) before computing.</li>
    <li>Use the matrix generator below to create matrices and perform operations like add, subtract, multiply, determinant, transpose, and inverse.</li>
  </ul>
</div>

<div class="layout">
  <div class="calculator">
    <!-- top: matrix-start form -->
    <div style="margin-bottom:12px;">
      <strong>Matrix generator (start)</strong>
      <div class="matrix-controls" style="margin-top:8px;">
        <label>Count <input type="number" id="mat-count" value="2" min="1" /></label>
        <label>Rows <input type="number" id="mat-rows" value="2" min="1" /></label>
        <label>Cols <input type="number" id="mat-cols" value="2" min="1" /></label>
        <button onclick="generateMatrices()" class="small">Generate</button>
      </div>
    </div>

    <!-- display -->
    <input id="display" type="text" placeholder="type expression or use buttons" />

    <!-- buttons -->
    <div class="buttons">
      <button onclick="push('7')">7</button>
      <button onclick="push('8')">8</button>
      <button onclick="push('9')">9</button>
      <button onclick="push('/')">÷</button>
      <button onclick="backspace()">⌫</button>

      <button onclick="push('4')">4</button>
      <button onclick="push('5')">5</button>
      <button onclick="push('6')">6</button>
      <button onclick="push('*')">×</button>
      <button onclick="push('^')">^</button>

      <button onclick="push('1')">1</button>
      <button onclick="push('2')">2</button>
      <button onclick="push('3')">3</button>
      <button onclick="push('-')">−</button>
      <button onclick="push('(')">(</button>

      <button onclick="push('0')">0</button>
      <button onclick="push('.')">.</button>
      <button onclick="push('=')">=</button>
      <button onclick="push('+')">+</button>
      <button onclick="push(')')">)</button>

      <button onclick="push('sin(')">sin</button>
      <button onclick="push('cos(')">cos</button>
      <button onclick="push('tan(')">tan</button>
      <button onclick="push('sqrt(')">√</button>
      <button onclick="push('log(')">log</button>

      <button onclick="push('diff(')">diff</button>
      <button onclick="push('integrate(')">∫</button>
      <button onclick="push('x')">x</button>
      <button onclick="push('y')">y</button>
      <button onclick="push('pi')">π</button>

      <button onclick="push('e')">e</button>
      <button onclick="compute()" style="grid-column:span 2;">Compute</button>
      <button onclick="clearDisplay()" style="grid-column:span 2;">Clear</button>
    </div>

    <!-- matrix inputs & controls (generated) -->
    <div id="mat-area" style="margin-top:12px;"></div>

    <div style="margin-top:10px;">
      Mode:
      <select id="mode">
        <option value="radian">Radian</option>
        <option value="degree">Degree</option>
      </select>
      Output:
      <select id="output">
        <option value="dec">Decimal</option>
        <option value="frac">Fraction</option>
      </select>
    </div>
  </div>

  <!-- right panel: history and matrix results -->
  <div class="panel">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
      <h3 style="margin:0">History</h3>
      <button onclick="clearHistory()" style="padding:6px 8px; border-radius:6px; border:1px solid #0ff; background:#0b0b0b; color:#cfffe6;">Clear History</button>
    </div>
    <div id="history" class="history"></div>

    <div style="margin-top:12px;">
      <strong>Matrix result (also sent to display)</strong>
      <div id="matrixResult" class="matrix-result"></div>
    </div>
  </div>
</div>

<script>
/* ---------- Helpers ---------- */
const display = document.getElementById('display');
function push(txt){
  display.value += txt;
  display.focus();
}
function clearDisplay(){ display.value = ''; display.focus(); }
function backspace(){ display.value = display.value.slice(0,-1); display.focus(); }

/* ---------- Keyboard support ---------- */
document.addEventListener('keydown', (e)=>{
  // allow normal typing into display
  if (e.key === 'Enter') { compute(); e.preventDefault(); return; }
  if (e.key === 'Backspace') { backspace(); return; }
  // otherwise let user type in the display normally — nothing forced
});

/* ---------- Compute (expression) ---------- */
async function compute(){
  const expr = display.value.trim();
  if(!expr) return;
  const mode = document.getElementById('mode').value;
  const output = document.getElementById('output').value;

  try {
    const resp = await fetch('/evaluate', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ expression: expr, mode: mode, output: output })
    });
    const data = await resp.json();
    if(resp.ok){
      // update display and history
      display.value = data.result;
      renderHistory(data.history);
    } else {
      // error
      display.value = data.error || 'Error';
      renderHistory(data.history || []);
    }
  } catch(err){
    display.value = 'Error';
    console.error(err);
  }
}

/* ---------- History rendering ---------- */
function renderHistory(hist){
  const el = document.getElementById('history');
  el.innerHTML = '';
  // show newest on top
  for(let i = hist.length-1; i >=0; --i){
    const entry = hist[i];
    const div = document.createElement('div');
    div.className = 'hist-entry';

    // If entry contains HTML table (for matrices) we allow it
    if (entry.includes('<table')) {
      div.innerHTML = entry;
    } else {
      div.textContent = entry;
    }
    el.appendChild(div);
  }
}

/* ---------- Clear history ---------- */
async function clearHistory(){
  await fetch('/clear_history', { method:'POST' });
  document.getElementById('history').innerHTML = '';
}

/* ---------- Matrix generator (start) ---------- */
function generateMatrices(){
  const count = Math.max(1, parseInt(document.getElementById('mat-count').value || 1));
  const rows = Math.max(1, parseInt(document.getElementById('mat-rows').value || 1));
  const cols = Math.max(1, parseInt(document.getElementById('mat-cols').value || 1));
  const area = document.getElementById('mat-area');
  area.innerHTML = '';

  // operation select + compute button
  const controls = document.createElement('div');
  controls.className = 'matrix-controls';
  controls.innerHTML = `
    <select id="mat-op" class="op-select">
      <option value="add">Add</option>
      <option value="sub">Subtract</option>
      <option value="mul">Multiply</option>
      <option value="div">Divide (A * inv(B))</option>
      <option value="det">Determinant (first)</option>
      <option value="transpose">Transpose (first)</option>
      <option value="inverse">Inverse (first)</option>
    </select>
    <button onclick="computeMatrix()">Compute Matrix</button>
  `;
  area.appendChild(controls);

  // create inputs for each matrix
  for(let k=0;k<count;k++){
    const box = document.createElement('div');
    box.style.marginTop = '10px';
    box.innerHTML = `<strong>Matrix ${k+1}</strong><div class="matrix-grid" id="matgrid_${k}"></div>`;
    area.appendChild(box);

    const grid = box.querySelector(`#matgrid_${k}`);
    for(let r=0;r<rows;r++){
      const rowDiv = document.createElement('div');
      for(let c=0;c<cols;c++){
        const inp = document.createElement('input');
        inp.type='number';
        inp.id = `m_${k}_${r}_${c}`;
        inp.value = '0';
        inp.style.width = '64px';
        rowDiv.appendChild(inp);
      }
      grid.appendChild(rowDiv);
    }
  }
}

/* ---------- Matrix compute ---------- */
async function computeMatrix(){
  // collect matrices from inputs
  const count = Math.max(1, parseInt(document.getElementById('mat-count').value || 1));
  const rows = Math.max(1, parseInt(document.getElementById('mat-rows').value || 1));
  const cols = Math.max(1, parseInt(document.getElementById('mat-cols').value || 1));
  const mats = [];

  for(let k=0;k<count;k++){
    const arr = [];
    for(let r=0;r<rows;r++){
      const row = [];
      for(let c=0;c<cols;c++){
        const val = parseFloat(document.getElementById(`m_${k}_${r}_${c}`).value || 0);
        row.push(val);
      }
      arr.push(row);
    }
    mats.push(arr);
  }

  const op = document.getElementById('mat-op').value;

  try {
    const resp = await fetch('/matrix', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ matrices: mats, operation: op })
    });
    const data = await resp.json();

    if(resp.ok){
      // For matrix result we put compact string in display and pretty HTML in matrixResult & history
      const res = data.result;
      display.value = res;

      // find newest history entry sent back and render -> backend stores pretty HTML for matrices
      renderHistory(data.history);
      // Also show pretty table in matrix result box if last history contains a table
      const last = data.history && data.history.length ? data.history[data.history.length-1] : '';
      const matrixResultDiv = document.getElementById('matrixResult');
      if(last && last.includes('<table')){
        matrixResultDiv.innerHTML = last;
      } else {
        matrixResultDiv.innerText = res;
      }
    } else {
      display.value = data.error || 'Error';
      renderHistory(data.history || []);
    }
  } catch(err){
    display.value = 'Error';
    console.error(err);
  }
}

/* ---------- init: generate at least once ---------- */
generateMatrices();

/* ---------- Guidelines toggle ---------- */
const guidelinesBtn = document.getElementById('guidelinesBtn');
const guidelinesPanel = document.getElementById('guidelinesPanel');

guidelinesBtn.addEventListener('click', () => {
  if (guidelinesPanel.style.display === 'none' || guidelinesPanel.style.display === '') {
    guidelinesPanel.style.display = 'block';
    guidelinesBtn.title = 'Hide Guidelines';
  } else {
    guidelinesPanel.style.display = 'none';
    guidelinesBtn.title = 'Show Guidelines';
  }
});

// Close guidelines if clicked outside
document.addEventListener('click', (e) => {
  if (!guidelinesPanel.contains(e.target) && e.target !== guidelinesBtn) {
    guidelinesPanel.style.display = 'none';
    guidelinesBtn.title = 'Show Guidelines';
  }
});
</script>
</body>
</html>